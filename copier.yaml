# Basic project information
module_name:
  type: str
  help: Name of the module (e.g., gitlab, snyk, wiz)
  default: mymodule

module_display_name:
  type: str
  help: Display name of the module (e.g., GitLab, Snyk, Wiz)
  default: "{{ module_name | replace('-', ' ') | title }}"

# Author information
author_name:
  type: str
  help: Your name
  default:

author_email:
  type: str
  help: Your email
  default:

year:
  type: int
  help: "Copyright year"
  default: "{{ '%Y' | strftime }}"
  when: false

package_name:
  type: str
  help: The name of the package to be created (e.g., mymodule)
  default: clearskies_{{ module_name|replace('-', '_') }}
  when: false

site_base_url:
  type: str
  help: The base url used for the documentation.
  default: https://clearskies.info

pypi_package_name:
  type: str
  help: The name of the PyPI package to be created (e.g., myservice)
  default: clear-skies-{{ module_name|replace('_', '-') | replace(' ', '-') }}
  when: false

docs_modules_location:
  type: str
  help: The location of the documentation modules.
  default: modules

docs_modules_location_trimmed:
  type: str
  help: The trimmed location of the documentation modules.
  default: "{{ docs_modules_location | regex_replace('^\\/|\\/$', '') }}"
  when: false

create_backends:
  type: bool
  help: Does this module need backends?
  default: false

create_columns:
  type: bool
  help: Does this module need columns?
  default: false

create_configs:
  type: bool
  help: Does this module need configs?
  default: false

create_endpoints:
  type: bool
  help: Does this module need endpoints?
  default: false

create_models:
  type: bool
  help: Does this module need models?
  default: false

_subdirectory: template_content
_templates_suffix: .jinja

# Template metadata for updates
_envops:
  block_start_string: '{%'
  block_end_string: '%}'
  variable_start_string: '{{'
  variable_end_string: '}}'
  comment_start_string: '{#'
  comment_end_string: '#}'

# Make sure git metadata is preserved for updates
_preserve_symlinks: true

_skip_if_exists:
    - "pyproject.toml"
    - "uv.lock"
    - 'src/{{ package_name }}/__init__.py'
    - 'src/{{ package_name }}/**/__init__.py'
    - "docs/python/config.json"
    - "CHANGELOG.md"

# Post-generation tasks
# The .venv is removed at the end to avoid "Argument list too long" errors during copier update.
# See: https://github.com/copier-org/copier/pull/2377
_tasks:
  - command: git init
    description: Initialize git repository
  - command: uv sync
    description: Install dependencies and create virtual environment
  - command: uv run pre-commit install
    description: Install pre-commit hooks
  - command: git add .
    description: Stage all files for pre-commit
  - command: uv run pre-commit run --all-files || true
    description: Run pre-commit on all files
  - command: uv lock --upgrade
    description: Update dependencies and update lock file
  - command: rm -rf .venv
    description: Remove .venv to avoid large diff during copier update

_message_after_copy: |
  Your project "{{ module_display_name }}" has been created!

  Next steps:
    cd {{ _copier_conf.dst_path }}
    uv sync
    git add .
    git commit -m "feat: Initial project setup"

_message_after_update: |
  Your project "{{ module_display_name }}" has been updated!

  Next steps:
    uv sync

_extensions:
  - jinja2_time.TimeExtension
